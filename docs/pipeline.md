# Data Processing Pipeline

## 1. 개요

본 문서는 배달 주문 이벤트 로그 분석 시스템의  
**데이터 처리 파이프라인(Data Processing Pipeline)** 을 정의한다.

본 파이프라인은 원시 이벤트 로그(`event_log`)를 입력으로 받아,
주문 단위 타임라인을 복원하고 KPI를 계산하여
리포트 및 대시보드에서 활용 가능한 결과를 생성하는 것을 목표로 한다.

모든 파이프라인은 **순수 JavaScript 기반**으로 구현된다.

---

## 2. 파이프라인 전체 흐름

```
Raw event_log
↓
(1) Load & Normalize
↓
(2) Timeline Builder
↓
(3) Lead Time Calculator
↓
(4) KPI Aggregator
↓
(5) Output / Visualization
```

각 단계는 **독립적인 책임**을 가지며,
앞 단계의 오류나 이상치는 가능한 한 해당 단계에서 흡수한다.

---

## 3. 단계별 상세 설계

### 3. 파이프라인 진입점

#### index.js

전체 데이터 처리 파이프라인의 진입점이다.

역할:

-   분석 대상 이벤트 로그 파일 경로 설정
-   파이프라인 각 단계를 순서대로 실행
-   최종 KPI 결과 출력

의미:

-   프로젝트 전체 흐름을 한눈에 보여주는 파일

---

### 4. 데이터 로딩 단계

#### loader/loadEventLog.js

원시 이벤트 로그 파일을 읽어오는 역할을 담당한다.

역할:

-   JSONL 또는 CSV 형태의 event_log 파일 로드
-   파일 내용을 객체 배열 형태로 변환
-   비즈니스 로직 없이 최소한의 파싱만 수행

의미:

-   외부 데이터와 내부 로직을 분리하는 경계 역할

---

### 5. 이벤트 정규화 단계

#### core/normalizeEvent.js

로드된 이벤트 데이터를 분석 가능한 형태로 정규화한다.

역할:

-   event_time 문자열을 Date 객체로 변환
-   event_type 값 표준화
-   필수 필드 존재 여부 검증
-   명백히 잘못된 이벤트 제거 또는 제외 처리

의미:

-   신뢰할 수 없는 원시 로그를 내부 표준 포맷으로 변환하는 단계

---

### 6. 타임라인 생성 단계

#### core/buildTimeline.js

이벤트 로그를 주문 단위 타임라인으로 재구성하는 핵심 단계이다.

역할:

-   order_id 기준 이벤트 그룹핑
-   event_time 기준 이벤트 정렬
-   event_id 기준 중복 이벤트 제거
-   필수 이벤트 누락 여부 감지

출력:

-   주문 1건당 하나의 타임라인 객체

의미:

-   KPI 계산이 가능한 구조를 만드는 파이프라인의 핵심 로직

---

### 7. 리드타임 계산 단계

#### core/calculateLeadTime.js

주문 타임라인을 기반으로 리드타임을 계산한다.

역할:

-   구간별 리드타임 계산
-   전체 배달 리드타임 계산
-   계산 불가능한 구간은 null 처리

의미:

-   이벤트 시점을 숫자 기반 지표로 변환하는 단계

---

### 8. KPI 집계 단계

#### core/aggregateKPI.js

주문 단위 리드타임 결과를 집계하여 KPI를 산출한다.

역할:

-   평균 리드타임 계산
-   지연 주문 비율 계산
-   병목 구간 Top N 산출
-   지역, 가게, 시간대 기준 그룹핑

의미:

-   개별 주문 데이터를 운영 인사이트로 변환하는 단계

---

### 9. 공통 유틸리티

#### utils/time.js

시간 관련 공통 로직을 담당한다.

역할:

-   시간 차이 계산
-   초, 분 단위 변환
-   시간대 계산

---

#### utils/groupBy.js

데이터 그룹핑을 위한 공통 유틸리티이다.

역할:

-   배열 데이터를 특정 키 기준으로 그룹핑
-   타임라인 생성 및 KPI 집계 단계에서 재사용

---

### 10. 파이프라인 요약

데이터 처리 흐름은 아래와 같이 구성된다.

index.js  
→ loadEventLog  
→ normalizeEvent  
→ buildTimeline  
→ calculateLeadTime  
→ aggregateKPI  
→ 결과 출력

본 구조는 단계별 책임을 명확히 분리하여
테스트, 유지보수, 확장이 용이하도록 설계되었다.

## 5. 설계 의도 요약

본 데이터 처리 파이프라인은 다음 설계 원칙을 따른다.

#### 단일 책임 원칙

-   각 단계는 하나의 명확한 역할만 수행한다
-   데이터 정제, 계산, 출력 로직을 분리한다

#### 이상치에 강한 구조

-   이벤트 누락, 중복, 순서 오류를 전제로 설계한다
-   파이프라인이 중간에 중단되지 않도록 한다

#### 확장 가능한 설계

-   KPI 추가 시 기존 파이프라인 변경을 최소화한다
-   데이터 차원(지역, 가게, 시간대) 확장을 고려한다

#### 학습 및 포트폴리오 목적 적합성

-   순수 JavaScript로 구현하여 로직 이해에 집중한다
-   실제 서비스 로그 구조를 단순화하여 재현한다
